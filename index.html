<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SOAN - Galerie Vidéo</title>
<style>
  /* Reset simple */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0;
    height: 100%;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: white;
    overflow-x: hidden;
  }

  /* Splash Screen */
  #splash {
    position: fixed;
    inset: 0;
    background: #121212;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 11000;
    user-select: none;
    padding: 20px;
  }
  #splash .soan-logo {
    font-size: 6rem;
    font-weight: 900;
    color: #ffdd00;
    text-transform: uppercase;
    letter-spacing: 0.7em;
    position: relative;
    margin-bottom: 3rem;
    user-select: none;
  }
  #splash .stars {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 300%;
    height: 300%;
    pointer-events: none;
    transform: translate(-50%, -50%);
    z-index: -1;
    font-size: 3rem;
    opacity: 0.3;
    user-select: none;
  }
  #splash input[type="password"] {
    font-size: 1.8rem;
    padding: 1.2rem 1.5rem;
    border-radius: 15px;
    border: 3px solid #ffdd00;
    background: transparent;
    color: white;
    width: 350px;
    max-width: 90vw;
    text-align: center;
    letter-spacing: 0.3em;
    font-weight: 900;
    transition: border-color 0.3s ease;
  }
  #splash input[type="password"]:focus {
    outline: none;
    border-color: #ffee55;
    box-shadow: 0 0 10px #ffee55;
  }
  #splash button {
    margin-top: 1.8rem;
    padding: 1rem 3rem;
    font-size: 1.4rem;
    font-weight: 900;
    background: #ffdd00;
    color: black;
    border-radius: 20px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  #splash button:hover,
  #splash button:focus {
    background: #e6c800;
    outline: none;
  }

  /* App container */
  #app {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    padding: 10px 20px 30px;
    overflow-y: auto;
  }

  /* SOAN container */
  .soan-container {
    position: relative;
    font-size: 3rem;
    font-weight: 900;
    color: #ffdd00;
    text-transform: uppercase;
    letter-spacing: 0.5em;
    margin-bottom: 1rem;
    user-select: none;
  }
  .soan-container .stars {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 300%;
    height: 300%;
    pointer-events: none;
    transform: translate(-50%, -50%);
    z-index: -1;
    font-size: 1.8rem;
    opacity: 0.3;
  }

  /* Sort container */
  .sort-container {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .sort-container label {
    font-weight: 700;
  }
  .sort-container select {
    padding: 6px 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: 2px solid #ffdd00;
    background: #222;
    color: white;
    cursor: pointer;
    user-select: none;
    transition: border-color 0.3s ease;
  }
  .sort-container select:focus {
    outline: none;
    border-color: #ffee55;
  }

  /* Video Grid */
  .video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 80px;
  }

  /* Video Card */
  .video-card {
    background: #1e1e1e;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(255, 221, 0, 0.3);
    overflow: hidden;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  .video-card:hover,
  .video-card:focus {
    transform: scale(1.05);
    box-shadow: 0 0 20px #ffdd00;
    outline: none;
  }
  .video-card .video-preview {
    width: 100%;
    height: 160px;
    object-fit: cover;
    background: black;
  }
  .video-card video.video-preview {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }

  .video-info {
    padding: 12px 15px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  .video-title {
    font-weight: 900;
    font-size: 1.2rem;
    margin-bottom: 6px;
    color: #ffdd00;
  }
  .video-desc {
    flex-grow: 1;
    font-size: 0.9rem;
    color: #ddd;
    margin-bottom: 12px;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  /* Buttons in card */
  .video-actions {
    display: flex;
    gap: 10px;
  }
  .btn {
    flex-grow: 1;
    background: #222;
    border: 2px solid #444;
    border-radius: 8px;
    padding: 6px 10px;
    font-weight: 700;
    font-size: 0.9rem;
    color: #ccc;
    cursor: pointer;
    user-select: none;
    transition: all 0.25s ease;
  }
  .btn:hover, .btn:focus {
    background: #ffdd00;
    color: black;
    border-color: #ffdd00;
    outline: none;
  }
  .btn.liked {
    background: #ffaa00;
    color: black;
    border-color: #ffaa00;
  }
  .btn.fav {
    background: #ffee55;
    color: black;
    border-color: #ffee55;
  }

  /* Add Video Button */
  #addVideoBtn {
    position: fixed;
    bottom: 25px;
    right: 25px;
    font-size: 2.8rem;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #ffdd00;
    border: none;
    color: black;
    cursor: pointer;
    box-shadow: 0 0 15px #ffdd00aa;
    transition: background-color 0.3s ease;
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #addVideoBtn:hover, #addVideoBtn:focus {
    background: #e6c800;
    outline: none;
  }

  /* Modals common */
  .modal-bg {
    position: fixed;
    inset: 0;
    background: rgba(18, 18, 18, 0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 12000;
    padding: 15px;
    overflow-y: auto;
  }
  .modal-bg.show {
    display: flex;
  }
  .modal {
    background: #1e1e1e;
    border-radius: 15px;
    max-width: 600px;
    width: 100%;
    padding: 25px 30px;
    box-shadow: 0 0 25px #ffdd00bb;
    position: relative;
  }
  .modal h2 {
    margin-top: 0;
    color: #ffdd00;
    font-weight: 900;
    letter-spacing: 0.1em;
    margin-bottom: 20px;
  }
  .modal label {
    display: block;
    font-weight: 700;
    margin-bottom: 6px;
    margin-top: 15px;
    color: #fff;
  }
  .modal input[type="text"],
  .modal input[type="password"],
  .modal textarea {
    width: 100%;
    padding: 10px 14px;
    border-radius: 10px;
    border: 2px solid #444;
    background: #222;
    color: white;
    font-size: 1rem;
    font-weight: 600;
    resize: vertical;
    transition: border-color 0.3s ease;
  }
  .modal input[type="text"]:focus,
  .modal input[type="password"]:focus,
  .modal textarea:focus {
    outline: none;
    border-color: #ffdd00;
    box-shadow: 0 0 12px #ffdd00aa;
  }
  .modal textarea {
    min-height: 80px;
  }
  .modal-actions {
    margin-top: 25px;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
  }
  .modal-actions button {
    background: #ffdd00;
    border: none;
    color: black;
    font-weight: 900;
    font-size: 1rem;
    padding: 10px 25px;
    border-radius: 20px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .modal-actions button:hover,
  .modal-actions button:focus {
    background: #e6c800;
    outline: none;
  }

  /* Player Modal specifics */
  .player-modal .modal {
    max-width: 900px;
    width: 90vw;
    padding: 0;
    background: transparent;
    box-shadow: none;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #playerContainer iframe,
  #playerContainer video {
    width: 100%;
    height: 500px;
    border-radius: 15px;
    box-shadow: 0 0 30px #ffdd00aa;
    background: black;
  }
  .player-modal .close-btn {
    position: fixed;
    top: 15px;
    right: 15px;
    font-size: 2.8rem;
    color: #ffdd00;
    background: rgba(18,18,18,0.9);
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 0 15px #ffdd00cc;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.3s ease;
    z-index: 13000;
  }
  .player-modal .close-btn:hover,
  .player-modal .close-btn:focus {
    background: #ffdd00;
    color: black;
    outline: none;
  }

  /* Error Message */
  #errorMsg {
    position: fixed;
    top: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: #ff3333dd;
    padding: 12px 25px;
    border-radius: 20px;
    font-weight: 700;
    color: white;
    box-shadow: 0 0 15px #ff4444bb;
    user-select: none;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    z-index: 14000;
    max-width: 90vw;
    text-align: center;
  }
  #errorMsg.show {
    opacity: 1;
    pointer-events: auto;
  }

  /* Responsive */
  @media (max-width: 600px) {
    #playerContainer iframe,
    #playerContainer video {
      height: 320px;
    }
    #splash input[type="password"] {
      width: 90vw;
      font-size: 1.5rem;
      padding: 1rem 1rem;
    }
  }
</style>
</head>
<body>

<!-- Splash Screen -->
<div id="splash" role="dialog" aria-modal="true" aria-labelledby="entryTitle" aria-describedby="entryDesc">
  <div class="soan-logo" aria-hidden="true">
    SOAN
    <div class="stars">✨✨✨✨✨✨✨</div>
  </div>
  <label for="entryCode" id="entryTitle" style="font-size:1.5rem; font-weight:700; margin-bottom:12px;">Entrez le code d’accès</label>
  <input
    id="entryCode"
    type="password"
    maxlength="10"
    autocomplete="off"
    aria-describedby="entryDesc"
    aria-required="true"
    placeholder="CODE D'ACCÈS"
  />
  <button id="entryBtn" aria-label="Valider le code d'accès">Entrer</button>
</div>

<!-- Main App -->
<div id="app" role="main" aria-live="polite" aria-atomic="true">
  <div class="soan-container" aria-hidden="true">
    SOAN
    <div class="stars">✨✨✨✨✨✨✨</div>
  </div>

  <div class="sort-container">
    <label for="sortSelect">Trier par :</label>
    <select id="sortSelect" aria-label="Trier les vidéos">
      <option value="code">Code</option>
      <option value="title">Titre</option>
    </select>
  </div>

  <div class="video-grid" id="videoGrid" tabindex="0" aria-label="Liste des vidéos"></div>

  <button id="addVideoBtn" aria-label="Ajouter une vidéo" title="Ajouter une vidéo">+</button>
</div>

<!-- Add Video Modal -->
<div id="addModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="addModalTitle" aria-describedby="addModalDesc">
  <div class="modal">
    <h2 id="addModalTitle">Ajouter une vidéo</h2>
    <form id="addVideoForm">
      <label for="videoCode">Code d’accès *</label>
      <input type="password" id="videoCode" maxlength="10" required autocomplete="off" />
      <label for="videoTitle">Titre *</label>
      <input type="text" id="videoTitle" maxlength="100" required />
      <label for="videoDesc">Description</label>
      <textarea id="videoDesc" maxlength="300" placeholder="Facultatif"></textarea>
      <label for="videoLink">Lien vidéo (YouTube ou direct)</label>
      <input type="text" id="videoLink" maxlength="500" placeholder="https://..." />
      <div class="modal-actions">
        <button type="submit">Ajouter</button>
        <button type="button" id="addModalCloseBtn">Annuler</button>
      </div>
    </form>
  </div>
</div>

<!-- Player Modal -->
<div id="playerModal" class="modal-bg player-modal" role="dialog" aria-modal="true" aria-labelledby="playerTitle" aria-describedby="playerDesc">
  <button class="close-btn" id="playerCloseBtn" aria-label="Fermer le lecteur">×</button>
  <div class="modal" style="padding:0; max-width:none;">
    <div id="playerContainer" aria-live="polite" aria-atomic="true" aria-label="Lecteur vidéo"></div>
  </div>
</div>

<!-- Error Message -->
<div id="errorMsg" role="alert" aria-live="assertive"></div>

<script>
  // CONSTANTES
  const SECRET_CODE = "2012";
  let videos = [];

  // ELEMENTS DOM
  const splash = document.getElementById("splash");
  const entryCodeInput = document.getElementById("entryCode");
  const entryBtn = document.getElementById("entryBtn");

  const app = document.getElementById("app");
  const videoGrid = document.getElementById("videoGrid");
  const sortSelect = document.getElementById("sortSelect");

  const addVideoBtn = document.getElementById("addVideoBtn");
  const addModal = document.getElementById("addModal");
  const addModalCloseBtn = document.getElementById("addModalCloseBtn");
  const addVideoForm = document.getElementById("addVideoForm");

  const playerModal = document.getElementById("playerModal");
  const playerCloseBtn = document.getElementById("playerCloseBtn");
  const playerContainer = document.getElementById("playerContainer");

  const errorMsg = document.getElementById("errorMsg");

  // UTILITAIRES
  function showError(msg, duration = 3500) {
    errorMsg.textContent = msg;
    errorMsg.classList.add("show");
    clearTimeout(showError.timeout);
    showError.timeout = setTimeout(() => {
      errorMsg.classList.remove("show");
    }, duration);
  }

  // Stockage local
  function saveVideos() {
    localStorage.setItem("soan_videos", JSON.stringify(videos));
  }
  function loadVideos() {
    try {
      const saved = localStorage.getItem("soan_videos");
      return saved ? JSON.parse(saved) : [];
    } catch {
      return [];
    }
  }

  // Validation URL basique
  function isValidUrl(url) {
    try {
      new URL(url);
      return true;
    } catch {
      return false;
    }
  }

  // Extrait ID YouTube si applicable
  function getYouTubeEmbedUrl(url) {
    if (!url) return null;
    const ytRegex = /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
    const match = url.match(ytRegex);
    return match ? `https://www.youtube.com/embed/${match[1]}` : null;
  }

  // RENDER VIDEOS
  function renderVideos() {
    videoGrid.innerHTML = "";
    let sortedVideos = [...videos];
    if (sortSelect.value === "code") {
      sortedVideos.sort((a,b) => a.code.localeCompare(b.code));
    } else {
      sortedVideos.sort((a,b) => a.title.localeCompare(b.title));
    }

    if (sortedVideos.length === 0) {
      videoGrid.innerHTML = `<p style="grid-column: 1/-1; color:#aaa; text-align:center; font-style:italic;">Aucune vidéo disponible.</p>`;
      return;
    }

    sortedVideos.forEach(video => {
      const card = document.createElement("article");
      card.className = "video-card";
      card.tabIndex = 0;
      card.setAttribute("aria-label", `Vidéo ${video.title}`);

      // Preview (YouTube embed or video thumbnail)
      let previewEl;
      const ytEmbed = getYouTubeEmbedUrl(video.link);
      if (ytEmbed) {
        // Static thumbnail from YouTube
        const ytId = ytEmbed.split("/").pop();
        previewEl = document.createElement("img");
        previewEl.src = `https://img.youtube.com/vi/${ytId}/hqdefault.jpg`;
        previewEl.alt = `Aperçu vidéo ${video.title}`;
        previewEl.className = "video-preview";
      } else if (video.link && isValidUrl(video.link)) {
        // Use video tag preview if possible
        previewEl = document.createElement("video");
        previewEl.src = video.link;
        previewEl.className = "video-preview";
        previewEl.muted = true;
        previewEl.playsInline = true;
        previewEl.setAttribute("aria-hidden", "true");
        previewEl.preload = "metadata";
      } else {
        previewEl = document.createElement("div");
        previewEl.className = "video-preview";
        previewEl.style.background = "#333";
        previewEl.textContent = "Pas de preview";
        previewEl.style.color = "#777";
        previewEl.style.display = "flex";
        previewEl.style.justifyContent = "center";
        previewEl.style.alignItems = "center";
      }

      card.appendChild(previewEl);

      // Info
      const infoDiv = document.createElement("div");
      infoDiv.className = "video-info";

      const titleEl = document.createElement("h3");
      titleEl.className = "video-title";
      titleEl.textContent = video.title || "(Sans titre)";
      infoDiv.appendChild(titleEl);

      const descEl = document.createElement("p");
      descEl.className = "video-desc";
      descEl.textContent = video.description || "";
      infoDiv.appendChild(descEl);

      // Actions
      const actionsDiv = document.createElement("div");
      actionsDiv.className = "video-actions";

      const playBtn = document.createElement("button");
      playBtn.className = "btn";
      playBtn.textContent = "▶️ Lire";
      playBtn.setAttribute("aria-label", `Lire la vidéo ${video.title}`);
      playBtn.onclick = (e) => {
        e.stopPropagation();
        openPlayer(video);
      };
      actionsDiv.appendChild(playBtn);

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "btn";
      deleteBtn.textContent = "🗑 Supprimer";
      deleteBtn.setAttribute("aria-label", `Supprimer la vidéo ${video.title}`);
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        promptDeleteVideo(video);
      };
      actionsDiv.appendChild(deleteBtn);

      infoDiv.appendChild(actionsDiv);

      card.appendChild(infoDiv);

      card.onclick = () => openPlayer(video);
      card.onkeypress = (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openPlayer(video);
        }
      };

      videoGrid.appendChild(card);
    });
  }

  // OPEN PLAYER
  function openPlayer(video) {
    playerContainer.innerHTML = ""; // Clear prev
    const ytEmbed = getYouTubeEmbedUrl(video.link);
    if (ytEmbed) {
      const iframe = document.createElement("iframe");
      iframe.src = ytEmbed + "?autoplay=1&rel=0";
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
      iframe.allowFullscreen = true;
      iframe.title = video.title;
      playerContainer.appendChild(iframe);
    } else if (video.link && isValidUrl(video.link)) {
      const vid = document.createElement("video");
      vid.src = video.link;
      vid.controls = true;
      vid.autoplay = true;
      vid.style.borderRadius = "15px";
      vid.setAttribute("aria-label", video.title);
      playerContainer.appendChild(vid);
    } else {
      playerContainer.textContent = "Vidéo non disponible";
    }
    playerModal.classList.add("show");
    playerCloseBtn.focus();
  }

  // CLOSE PLAYER
  playerCloseBtn.onclick = () => {
    playerModal.classList.remove("show");
    playerContainer.innerHTML = "";
  };
  playerModal.onclick = (e) => {
    if (e.target === playerModal) {
      playerModal.classList.remove("show");
      playerContainer.innerHTML = "";
    }
  };

  // PROMPT DELETE VIDEO
  function promptDeleteVideo(video) {
    const userCode = prompt("Pour supprimer cette vidéo, entrez le code d'accès :");
    if (userCode === null) return; // Cancel
    if (userCode !== video.code) {
      showError("Code d'accès incorrect, suppression annulée");
      return;
    }
    videos = videos.filter(v => v !== video);
    saveVideos();
    renderVideos();
    showError("Vidéo supprimée", 2500);
  }

  // ADD VIDEO MODAL HANDLING
  addVideoBtn.onclick = () => {
    addModal.classList.add("show");
    addVideoForm.reset();
    document.getElementById("videoCode").focus();
  };
  addModalCloseBtn.onclick = () => {
    addModal.classList.remove("show");
  };
  addModal.onclick = (e) => {
    if (e.target === addModal) {
      addModal.classList.remove("show");
    }
  };

  // SUBMIT ADD VIDEO
  addVideoForm.onsubmit = (e) => {
    e.preventDefault();
    const code = document.getElementById("videoCode").value.trim();
    const title = document.getElementById("videoTitle").value.trim();
    const description = document.getElementById("videoDesc").value.trim();
    const link = document.getElementById("videoLink").value.trim();

    if (!code || !title) {
      showError("Code et titre sont obligatoires.");
      return;
    }
    if (link && !isValidUrl(link)) {
      showError("Le lien vidéo est invalide.");
      return;
    }
    videos.push({ code, title, description, link });
    saveVideos();
    renderVideos();
    addModal.classList.remove("show");
  };

  // ENTRY CODE CHECK
  function checkEntryCode() {
    const code = entryCodeInput.value.trim();
    if (code === SECRET_CODE) {
      splash.style.display = "none";
      app.style.display = "flex";
      videos = loadVideos();
      renderVideos();
    } else {
      showError("Code d’accès incorrect");
    }
  }
  entryBtn.onclick = checkEntryCode;
  entryCodeInput.onkeypress = (e) => {
    if (e.key === "Enter") {
      checkEntryCode();
    }
  };

  // SORT CHANGE
  sortSelect.onchange = renderVideos;

  // INIT
  app.style.display = "none";
</script>

</body>
</html>
