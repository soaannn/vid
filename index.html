<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Soan - Ajouter vid√©o par lien</title>
<style>
  body {
    margin: 0;
    background: #121212;
    color: #fff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
    min-height: 100vh;
  }
  .soan-container {
    position: relative;
    font-size: 3rem;
    font-weight: 900;
    color: #ffdd00;
    text-transform: uppercase;
    letter-spacing: 0.3em;
    margin: 1rem 0 2rem;
    user-select: none;
  }
  .stars {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200%;
    height: 200%;
    pointer-events: none;
    transform: translate(-50%, -50%);
    z-index: -1;
  }
  .star {
    position: absolute;
    color: #fff;
    font-size: 1.2rem;
    animation: twinkle 3s infinite ease-in-out;
    filter: drop-shadow(0 0 3px #fff);
  }
  .star:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
  .star:nth-child(2) { top: 30%; left: 70%; animation-delay: 1s; }
  .star:nth-child(3) { top: 60%; left: 50%; animation-delay: 2s; }
  .star:nth-child(4) { top: 75%; left: 15%; animation-delay: 1.5s; }
  .star:nth-child(5) { top: 40%; left: 80%; animation-delay: 0.7s; }
  @keyframes twinkle {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }
  .sort-container {
    margin-bottom: 1rem;
  }
  select {
    padding: 0.4rem;
    background: #222;
    color: white;
    border-radius: 5px;
    border: 1px solid #444;
    font-size: 1rem;
  }
  .video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 1rem;
    width: 100%;
    max-width: 1000px;
    margin-bottom: 4rem;
  }
  .video-card {
    background: #1e1e1e;
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  video, iframe {
    width: 100%;
    height: 180px;
    background: black;
    border-bottom: 1px solid #333;
  }
  .video-info {
    padding: 0.8rem;
  }
  .video-title {
    font-weight: bold;
    margin-bottom: 0.4rem;
    font-size: 1.1rem;
    word-break: break-word;
  }
  .video-desc {
    font-size: 0.9rem;
    color: #ccc;
    margin-bottom: 0.6rem;
    min-height: 40px;
    word-break: break-word;
  }
  .video-actions {
    display: flex;
    gap: 0.5rem;
  }
  .btn {
    flex: 1;
    padding: 0.4rem;
    background: #333;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    font-size: 1rem;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .btn:hover {
    background: #555;
  }
  .liked {
    background: #ffdd00;
    color: black;
  }
  .fav {
    background: #ff0000;
  }
  #addVideoBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #ffdd00;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(255,221,0,0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: black;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  #addVideoBtn:hover {
    background: #e6c800;
    box-shadow: 0 6px 20px rgba(230,200,0,0.9);
  }
  #errorOverlay {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(255,0,0,0.85);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1rem;
    user-select: none;
    box-shadow: 0 4px 15px rgba(255,0,0,0.9);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    z-index: 10000;
    max-width: 320px;
  }
  #errorOverlay.show {
    opacity: 1;
    pointer-events: auto;
  }
</style>
</head>
<body>

  <div class="soan-container">
    Soan
    <div class="stars">
      <span class="star">‚òÖ</span>
      <span class="star">‚òÖ</span>
      <span class="star">‚òÖ</span>
      <span class="star">‚òÖ</span>
      <span class="star">‚òÖ</span>
    </div>
  </div>

  <div class="sort-container">
    <label for="sort">Trier par : </label>
    <select id="sort">
      <option value="title">Titre</option>
      <option value="likes">Likes</option>
      <option value="fav">Favoris</option>
    </select>
  </div>

  <div class="video-grid" id="videoGrid"></div>

  <button id="addVideoBtn" title="Ajouter une vid√©o">+</button>

  <div id="errorOverlay"></div>

<script>
  const videoGrid = document.getElementById('videoGrid');
  const sortSelect = document.getElementById('sort');
  const addVideoBtn = document.getElementById('addVideoBtn');
  const errorOverlay = document.getElementById('errorOverlay');

  let videos = [];

  function showError(message) {
    errorOverlay.textContent = message;
    errorOverlay.classList.add('show');
    setTimeout(() => {
      errorOverlay.classList.remove('show');
    }, 5000);
  }

  function saveVideos() {
    try {
      localStorage.setItem('videosMeta', JSON.stringify(videos));
    } catch (err) {
      showError("Erreur stockage local : " + err.message);
    }
  }

  function loadVideos() {
    try {
      const stored = localStorage.getItem('videosMeta');
      return stored ? JSON.parse(stored) : [];
    } catch (err) {
      showError("Erreur lecture stockage local : " + err.message);
      return [];
    }
  }

  // Transforme un lien YouTube en iframe embarqu√©
  function getYouTubeEmbedUrl(url) {
    try {
      const urlObj = new URL(url);
      if (urlObj.hostname.includes('youtube.com')) {
        const v = urlObj.searchParams.get('v');
        if(v) return `https://www.youtube.com/embed/${v}`;
      } else if (urlObj.hostname === 'youtu.be') {
        const id = urlObj.pathname.slice(1);
        if(id) return `https://www.youtube.com/embed/${id}`;
      }
    } catch {
      return null;
    }
    return null;
  }

  // G√©n√®re le HTML vid√©o ou iframe selon le lien
  function createVideoElement(video) {
    if (video.url.includes('youtube.com') || video.url.includes('youtu.be')) {
      const iframe = document.createElement('iframe');
      iframe.src = getYouTubeEmbedUrl(video.url);
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
      iframe.allowFullscreen = true;
      return iframe;
    } else {
      const videoEl = document.createElement('video');
      videoEl.src = video.url;
      videoEl.controls = true;
      videoEl.preload = "metadata";
      return videoEl;
    }
  }

  function renderVideos() {
    videoGrid.innerHTML = '';
    let sorted = [...videos];
    if (sortSelect.value === 'title') {
      sorted.sort((a,b) => a.title.localeCompare(b.title));
    } else if (sortSelect.value === 'likes') {
      sorted.sort((a,b) => b.likes - a.likes);
    } else if (sortSelect.value === 'fav') {
      sorted.sort((a,b) => (b.fav ? 1 : 0) - (a.fav ? 1 : 0));
    }
    sorted.forEach(vid => {
      const card = document.createElement('div');
      card.className = 'video-card';

      const media = createVideoElement(vid);
      card.appendChild(media);

      const info = document.createElement('div');
      info.className = 'video-info';

      const title = document.createElement('div');
      title.className = 'video-title';
      title.textContent = vid.title;

      const desc = document.createElement('div');
      desc.className = 'video-desc';
      desc.textContent = vid.desc;

      const actions = document.createElement('div');
      actions.className = 'video-actions';

      const likeBtn = document.createElement('button');
      likeBtn.className = 'btn' + (vid.liked ? ' liked' : '');
      likeBtn.textContent = `üëç ${vid.likes}`;
      likeBtn.onclick = () => {
        vid.liked = !vid.liked;
        vid.likes += vid.liked ? 1 : -1;
        saveVideos();
        renderVideos();
      };

      const favBtn = document.createElement('button');
      favBtn.className = 'btn' + (vid.fav ? ' fav' : '');
      favBtn.textContent = '‚òÖ';
      favBtn.onclick = () => {
        vid.fav = !vid.fav;
        saveVideos();
        renderVideos();
      };

      actions.appendChild(likeBtn);
      actions.appendChild(favBtn);

      info.appendChild(title);
      info.appendChild(desc);
      info.appendChild(actions);

      card.appendChild(info);

      videoGrid.appendChild(card);
    });
  }

  addVideoBtn.addEventListener('click', () => {
    const code = prompt('Entrez le code d‚Äôacc√®s pour ajouter une vid√©o :');
    if (code !== '2012') {
      showError('Code incorrect, ajout annul√©.');
      return;
    }
    const url = prompt('Collez le lien de la vid√©o (YouTube, Vimeo, ou lien direct mp4) :');
    if (!url || !url.trim()) {
      showError('Lien de vid√©o vide ou invalide.');
      return;
    }
    const title = prompt('Titre de la vid√©o :') || 'Sans titre';
    const desc = prompt('Description :') || '';

    // Pour validation basique, on accepte si √ßa ressemble √† une URL
    try {
      new URL(url);
    } catch {
      showError('Lien vid√©o non valide.');
      return;
    }

    videos.push({
      url: url.trim(),
      title: title.trim(),
      desc: desc.trim(),
      likes: 0,
      liked: false,
      fav: false
    });
    saveVideos();
    renderVideos();
  });

  sortSelect.addEventListener('change', renderVideos);

  // Chargement initial
  videos = loadVideos();
  renderVideos();

</script>

</body>
</html>
